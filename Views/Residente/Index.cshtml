@model Residente
@{
    ViewData["Title"] = "Dashboard Residente";
    Layout = "_Layout"; /* Asegura que use el layout con navbar */
}

<div style="max-width: 1200px; margin: 0 auto; padding: 25px 15px;">
    <!-- Encabezado mejorado -->
    <div style="background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 6px 15px rgba(14, 165, 233, 0.2);">
        <h2 style="margin: 0; display: flex; align-items: center; gap: 12px; font-size: 1.8rem;">
            <i class="bi bi-house-door-fill"></i> Dashboard Residente
        </h2>
        <p style="margin: 10px 0 0 0; font-size: 1.1rem; opacity: 0.9;">
            Bienvenido, <strong style="font-weight: 600;">@Model.Usuario?.Nombre</strong>
        </p>
    </div>

    <!-- Acceso rápido -->
    <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 30px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
        <a href="/Residente/Notificaciones"
           style="background: #fef3c7; color: #92400e; padding: 12px 20px; border-radius: 6px; text-decoration: none; display: flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.2s;">
            <i class="bi bi-bell-fill"></i>
            Notificaciones

            @if ((ViewBag.NotificacionesPendientes ?? 0) > 0)
            {
                <span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 5px;">
                    @ViewBag.NotificacionesPendientes
                </span>
            }
        </a>

        <a href="/Residente/Historial"
           style="background: #dbeafe; color: #1e40af; padding: 12px 20px; border-radius: 6px; text-decoration: none; display: flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.2s;">
            <i class="bi bi-clock-history"></i>
            Historial de Visitas
        </a>

        <a href="/Residente/Preaprobados"
           style="background: #d1fae5; color: #065f46; padding: 12px 20px; border-radius: 6px; text-decoration: none; display: flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.2s;">
            <i class="bi bi-check-circle-fill"></i>
            Visitantes Preaprobados
        </a>

        <a href="/Residente/Vehiculos"
           style="background: #e0e7ff; color: #3730a3; padding: 12px 20px; border-radius: 6px; text-decoration: none; display: flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.2s;">
            <i class="bi bi-car-front-fill"></i>
            Mis Vehículos
        </a>
    </div>

    <!-- Sección: Información del Residente -->
    <h3 style="color: #4b5563; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb;">
        <i class="bi bi-person-badge" style="margin-right: 10px;"></i>Información del Residente
    </h3>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px;">
        <!-- Tarjeta Unidad -->
        <div style="background: white; border-left: 4px solid #0ea5e9; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="background: #dbeafe; color: #1d4ed8; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px;">
                    <i class="bi bi-house"></i>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; text-transform: uppercase;">Unidad</div>
                    <div style="font-size: 20px; font-weight: 600; color: #1e40af;">@Model.Unidad</div>
                </div>
            </div>
        </div>

        <!-- Tarjeta Estado -->
        <div style="background: white; border-left: 4px solid #10b981; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="background: #d1fae5; color: #059669; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px;">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; text-transform: uppercase;">Estado</div>
                    <div style="font-size: 20px; font-weight: 600; color: #065f46;">
                        @if (Model.Activo.GetValueOrDefault())
                        {
                            <span style="color: #10b981;">Activo</span>
                        }
                        else
                        {
                            <span style="color: #ef4444;">Inactivo</span>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Tarjeta Contacto -->
        <div style="background: white; border-left: 4px solid #8b5cf6; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="background: #f3e8ff; color: #7c3aed; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px;">
                    <i class="bi bi-telephone"></i>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; text-transform: uppercase;">Contacto</div>
                    <div style="font-size: 16px; font-weight: 500; color: #1f2937;">@Model.Usuario?.Telefono</div>
                    <div style="font-size: 14px; color: #6b7280; margin-top: 4px;">@Model.Usuario?.Email</div>
                </div>
            </div>
        </div>

        <!-- Tarjeta Dirección -->
        <div style="background: white; border-left: 4px solid #f59e0b; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="background: #fef3c7; color: #d97706; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 22px;">
                    <i class="bi bi-geo-alt"></i>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; text-transform: uppercase;">Dirección</div>
                    <div style="font-size: 14px; font-weight: 500; color: #1f2937;">@Model.Direccion</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección: Mis Vehículos Registrados -->
    <h3 style="color: #4b5563; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb;">
        <i class="bi bi-car-front-fill" style="margin-right: 10px;"></i>Mis Vehículos Registrados
    </h3>

    @if (Model.VehiculosResidentes != null && Model.VehiculosResidentes.Any())
    {
        <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-bottom: 40px;">
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white;">
                        <tr>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Placa</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Marca</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Modelo</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Color</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Alias</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var vr in Model.VehiculosResidentes)
                        {
                            <tr style="border-bottom: 1px solid #e5e7eb; transition: background 0.2s;">
                                <td style="padding: 16px; font-weight: 500; color: #1f2937;">@vr.Vehiculo?.Placa</td>
                                <td style="padding: 16px; color: #4b5563;">@vr.Vehiculo?.Marca</td>
                                <td style="padding: 16px; color: #4b5563;">@vr.Vehiculo?.Modelo</td>
                                <td style="padding: 16px; color: #4b5563;">
                                    <span style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #ccc; vertical-align: middle; margin-right: 6px;"></span>
                                    @vr.Vehiculo?.Color
                                </td>
                                <td style="padding: 16px;">
                                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 4px; font-size: 13px; font-weight: 500;">
                                        @vr.Alias
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div style="background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 10px; padding: 40px; text-align: center; margin-bottom: 40px;">
            <i class="bi bi-car-front" style="font-size: 48px; color: #94a3b8; margin-bottom: 15px; display: block;"></i>
            <p style="color: #64748b; font-size: 1.1rem; margin-bottom: 15px;">No tienes vehículos registrados</p>
            <a href="/Residente/Vehiculos" style="background: #0ea5e9; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                <i class="bi bi-plus-circle"></i> Registrar Vehículo
            </a>
        </div>
    }

    <!-- Sección: Visitas Recientes -->
    <h3 style="color: #4b5563; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb;">
        <i class="bi bi-clock-history" style="margin-right: 10px;"></i>Visitas Recientes
    </h3>

    @if (ViewBag.VisitasRecientes != null && ViewBag.VisitasRecientes.Count > 0)
    {
        <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-bottom: 40px;">
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">
                        <tr>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Fecha/Hora</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Visitante</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Vehículo</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Motivo</th>
                            <th style="padding: 16px; text-align: left; font-weight: 600;">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var visita in ViewBag.VisitasRecientes)
                        {
                            <tr style="border-bottom: 1px solid #e5e7eb; transition: background 0.2s;">
                                <td style="padding: 16px; font-weight: 500; color: #1f2937;">
                                    <i class="bi bi-calendar-event" style="margin-right: 6px; color: #6b7280;"></i>
                                    @visita.FechaEntrada?.ToString("dd/MM/yyyy HH:mm")
                                </td>
                                <td style="padding: 16px; color: #4b5563;">@visita.Visitante?.Nombre</td>
                                <td style="padding: 16px;">
                                    <span style="background: #f1f5f9; padding: 4px 10px; border-radius: 4px; font-family: monospace; font-weight: 500;">
                                        @visita.Vehiculo?.Placa
                                    </span>
                                </td>
                                <td style="padding: 16px; color: #4b5563;">@visita.MotivoVisita</td>
                                <td style="padding: 16px;">
                                    @if (visita.FechaSalida != null)
                                    {
                                        <span style="background: #d1fae5; color: #065f46; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 500;">
                                            <i class="bi bi-check-circle" style="margin-right: 4px;"></i>
                                            Salida: @visita.FechaSalida?.ToString("HH:mm")
                                        </span>
                                    }
                                    else
                                    {
                                        <span style="background: #fef3c7; color: #92400e; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 500;">
                                            <i class="bi bi-clock" style="margin-right: 4px;"></i>
                                            En fraccionamiento
                                        </span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div style="background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 10px; padding: 40px; text-align: center; margin-bottom: 40px;">
            <i class="bi bi-person-x" style="font-size: 48px; color: #94a3b8; margin-bottom: 15px; display: block;"></i>
            <p style="color: #64748b; font-size: 1.1rem;">No hay visitas recientes</p>
        </div>
    }

    <!-- Sección: Flujo del Sistema -->
    <div style="background: linear-gradient(135deg, #f8fafc, #f1f5f9); border-radius: 12px; padding: 25px; margin-top: 30px; border-left: 4px solid #0ea5e9;">
        <h4 style="color: #1e40af; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <i class="bi bi-info-circle-fill"></i> Acceso para Visitantes - Flujo del Sistema
        </h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
                <div style="background: #dbeafe; color: #1d4ed8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-weight: bold;">1</div>
                <div style="font-weight: 500; margin-bottom: 5px;">Visitante llega</div>
                <div style="font-size: 13px; color: #6b7280;">El visitante llega a la caseta del fraccionamiento</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
                <div style="background: #dbeafe; color: #1d4ed8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-weight: bold;">2</div>
                <div style="font-weight: 500; margin-bottom: 5px;">Verificación</div>
                <div style="font-size: 13px; color: #6b7280;">El guardia verifica si es residente o visitante</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
                <div style="background: #dbeafe; color: #1d4ed8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-weight: bold;">3</div>
                <div style="font-weight: 500; margin-bottom: 5px;">Solicitud enviada</div>
                <div style="font-size: 13px; color: #6b7280;">El guardia te envía una solicitud de autorización</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
                <div style="background: #dbeafe; color: #1d4ed8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-weight: bold;">4</div>
                <div style="font-weight: 500; margin-bottom: 5px;">Tu respuesta</div>
                <div style="font-size: 13px; color: #6b7280;">Revisa <a href="/Residente/Notificaciones" style="color: #0ea5e9; font-weight: 500;">Notificaciones</a> para aprobar o rechazar</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
                <div style="background: #dbeafe; color: #1d4ed8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-weight: bold;">5</div>
                <div style="font-weight: 500; margin-bottom: 5px;">Acceso permitido</div>
                <div style="font-size: 13px; color: #6b7280;">Si apruebas, el visitante puede ingresar</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
                <div style="background: #dbeafe; color: #1d4ed8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-weight: bold;">6</div>
                <div style="font-weight: 500; margin-bottom: 5px;">Acceso denegado</div>
                <div style="font-size: 13px; color: #6b7280;">Si rechazas, se registrará un incidente</div>
            </div>
        </div>
    </div>

    <!-- Información del sistema -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center;">
        <div style="color: #6b7280; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i class="bi bi-calendar-event"></i>
            <span>Consulta actual: <strong>@DateTime.Now.ToString("dd/MM/yyyy HH:mm")</strong></span>
        </div>
        <div style="color: #9ca3af; font-size: 14px; margin-top: 10px;">
            <i class="bi bi-house-check"></i> Panel Residente - Sistema de Control de Acceso
        </div>
    </div>
</div>

<!-- Efecto hover para enlaces de acceso rápido -->
<style>
    /* Efecto hover en enlaces de acceso rápido */
    a[href*="/Residente/"]:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-decoration: none;
    }

    /* Efecto hover en filas de tablas */
    table tbody tr:hover {
        background-color: #f8fafc;
    }

    /* Responsive para móviles */
    @@media (max-width: 768px) {
        div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
            gap: 15px !important;
        }

        div[style*="padding: 20px;"] {
            padding: 16px !important;
        }

        .acceso-rapido {
            flex-direction: column;
        }
    }
</style>