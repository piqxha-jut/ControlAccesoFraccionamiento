@{
    ViewBag.Title = "Buscar Información";
    Layout = "_Layout";
}

<div style="max-width: 1200px; margin: 0 auto; padding: 25px 15px;">
    <!-- Encabezado -->
    <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div>
                <h2 style="margin: 0; display: flex; align-items: center; gap: 12px; font-size: 1.8rem;">
                    <i class="bi bi-search"></i> Buscar Información
                </h2>
                <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 1rem;">
                    Consulta vehículos por placa o residentes por unidad
                </p>
            </div>
            <a href="/Guardia/Index"
               style="background: rgba(255, 255, 255, 0.1); color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.2s;">
                <i class="bi bi-arrow-left"></i> Volver al Panel
            </a>
        </div>
    </div>

    <!-- Formulario de búsqueda -->
    <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-bottom: 30px;">
        <div style="background: #f8fafc; padding: 18px 24px; border-bottom: 1px solid #e5e7eb;">
            <h3 style="margin: 0; display: flex; align-items: center; gap: 10px; color: #4b5563;">
                <i class="bi bi-funnel"></i> Criterios de Búsqueda
            </h3>
        </div>

        <div style="padding: 25px;">
            <form method="post" action="/Guardia/Buscar">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 25px;">
                    <!-- Buscar por Placa -->
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: #f9fafb;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <div style="background: #e9d5ff; color: #7c3aed; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-car-front-fill"></i>
                            </div>
                            <h4 style="margin: 0; color: #374151;">Buscar por Placa</h4>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #4b5563;">
                                <i class="bi bi-123"></i> Placa del vehículo
                            </label>
                            <input type="text" name="placa" placeholder="Ej: ABC123" class="form-control"
                                   style="font-family: monospace; font-size: 1.1rem; letter-spacing: 1px;" />
                            <div style="font-size: 13px; color: #6b7280; margin-top: 6px;">
                                <i class="bi bi-info-circle"></i> Ingresa la placa completa del vehículo
                            </div>
                        </div>
                    </div>

                    <!-- Buscar por Unidad -->
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: #f9fafb;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <div style="background: #dbeafe; color: #1d4ed8; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-house-fill"></i>
                            </div>
                            <h4 style="margin: 0; color: #374151;">Buscar por Unidad</h4>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #4b5563;">
                                <i class="bi bi-building"></i> Unidad residencial
                            </label>
                            <input type="text" name="unidad" placeholder="Ej: A101, B203, etc." class="form-control"
                                   style="font-family: monospace; font-size: 1.1rem;" />
                            <div style="font-size: 13px; color: #6b7280; margin-top: 6px;">
                                <i class="bi bi-info-circle"></i> Ingresa el número de unidad
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div style="display: flex; gap: 15px; justify-content: flex-end; border-top: 1px solid #e5e7eb; padding-top: 25px;">
                    <button type="reset" class="btn btn-secondary" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px;">
                        <i class="bi bi-eraser"></i> Limpiar
                    </button>
                    <button type="submit" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px;">
                        <i class="bi bi-search"></i> Buscar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Resultados de búsqueda -->
    @if (ViewBag.Error != null)
    {
        <div style="background: #fee2e2; color: #991b1b; padding: 16px 20px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #ef4444;">
            <div style="display: flex; align-items: flex-start; gap: 12px;">
                <i class="bi bi-exclamation-triangle-fill" style="color: #ef4444; font-size: 1.2rem; margin-top: 2px;"></i>
                <div>
                    <h4 style="margin: 0 0 5px 0; font-size: 1.1rem;">Error en la búsqueda</h4>
                    <p style="margin: 0;">@ViewBag.Error</p>
                </div>
            </div>
        </div>
    }

    <!-- Resultados por Placa -->
    @if (ViewBag.TipoBusqueda == "placa")
    {
        <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-bottom: 30px;">
            <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 20px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 10px; font-size: 1.5rem;">
                    <i class="bi bi-car-front"></i> Resultados para placa: <span style="font-family: monospace;">@ViewBag.Placa</span>
                </h3>
            </div>

            <div style="padding: 25px;">
                <!-- Información básica del vehículo -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="font-size: 13px; color: #6b7280; margin-bottom: 5px;">Placa</div>
                        <div style="font-weight: 600; font-size: 1.2rem; font-family: monospace;">@ViewBag.Placa</div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="font-size: 13px; color: #6b7280; margin-bottom: 5px;">Marca</div>
                        <div style="font-weight: 600;">@ViewBag.Marca</div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="font-size: 13px; color: #6b7280; margin-bottom: 5px;">Modelo</div>
                        <div style="font-weight: 600;">@ViewBag.Modelo</div>
                    </div>
                </div>

                <!-- Estado de residente -->
                <div style="margin-bottom: 25px;">
                    @if (ViewBag.EsResidente == true)
                    {
                        <div style="background: #d1fae5; color: #065f46; padding: 15px; border-radius: 8px; border: 1px solid #bbf7d0;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="bi bi-check-circle-fill" style="font-size: 1.2rem;"></i>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1rem;">✅ Vehículo de RESIDENTE</div>
                                    <div style="font-size: 14px; margin-top: 4px;">Este vehículo está registrado a nombre de un residente del fraccionamiento</div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div style="background: #f3f4f6; color: #4b5563; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="bi bi-person" style="font-size: 1.2rem;"></i>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1rem;">👤 Vehículo NO residente</div>
                                    <div style="font-size: 14px; margin-top: 4px;">Este vehículo no está registrado como vehículo de residente</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Estado del vehículo -->
                <div style="margin-bottom: 25px;">
                    @if (ViewBag.EstadoVehiculo == "dentro")
                    {
                        <div style="background: #dbeafe; color: #1e40af; padding: 20px; border-radius: 8px; border-left: 4px solid #1d4ed8;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                                <div style="background: #3b82f6; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-check-lg"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.2rem;">🟢 VEHÍCULO DENTRO DEL FRACCIONAMIENTO</div>
                                    <div style="font-size: 14px;">El vehículo se encuentra actualmente dentro</div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <div style="font-size: 13px; color: #1e40af; margin-bottom: 5px;">Fecha de entrada</div>
                                    <div style="font-weight: 600;">@ViewBag.InfoDentro.FechaEntrada.ToString("dd/MM/yyyy HH:mm")</div>
                                </div>
                                <div>
                                    <div style="font-size: 13px; color: #1e40af; margin-bottom: 5px;">Unidad visitando</div>
                                    <div style="font-weight: 600; color: #7c3aed;">@ViewBag.InfoDentro.ResidenteDestino?.Unidad</div>
                                </div>
                            </div>
                        </div>
                    }
                    else if (ViewBag.EstadoVehiculo == "pendiente")
                    {
                        <div style="background: #fef3c7; color: #92400e; padding: 20px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                                <div style="background: #f59e0b; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-clock"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.2rem;">🟡 SOLICITUD PENDIENTE</div>
                                    <div style="font-size: 14px;">Esperando respuesta del residente</div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <div style="font-size: 13px; color: #92400e; margin-bottom: 5px;">Unidad destino</div>
                                    <div style="font-weight: 600;">@ViewBag.InfoPendiente.ResidenteDestino?.Unidad</div>
                                </div>
                                <div>
                                    <div style="font-size: 13px; color: #92400e; margin-bottom: 5px;">Fecha solicitud</div>
                                    <div style="font-weight: 600;">@ViewBag.InfoPendiente.FechaEntrada.ToString("dd/MM/yyyy HH:mm")</div>
                                </div>
                            </div>
                        </div>
                    }
                    else if (ViewBag.EstadoVehiculo == "fuera")
                    {
                        <div style="background: #d1fae5; color: #065f46; padding: 20px; border-radius: 8px; border-left: 4px solid #10b981;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="background: #10b981; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-check2-circle"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.2rem;">🔵 VEHÍCULO FUERA</div>
                                    <div style="font-size: 14px;">No tiene registros activos ni solicitudes pendientes</div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Lista Negra -->
                @if (ViewBag.ListaNegra != null)
                {
                    <div style="background: #fee2e2; color: #991b1b; padding: 20px; border-radius: 8px; border: 2px solid #ef4444;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                            <div style="background: #ef4444; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 1.2rem;">🚫 ¡ATENCIÓN! VEHÍCULO EN LISTA NEGRA</div>
                                <div style="font-size: 14px;">Acceso restringido inmediatamente</div>
                            </div>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 6px;">
                            <div style="font-size: 13px; color: #991b1b; margin-bottom: 5px;">Razón del bloqueo</div>
                            <div style="font-weight: 600; font-size: 1.1rem;">@ViewBag.ListaNegra.Razon</div>
                        </div>
                    </div>
                }
                else
                {
                    <div style="background: #d1fae5; color: #065f46; padding: 15px; border-radius: 8px; text-align: center;">
                        <i class="bi bi-shield-check" style="font-size: 1.2rem; margin-right: 8px;"></i>
                        <span style="font-weight: 600;">✅ Este vehículo NO está en lista negra</span>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Resultados por Unidad -->
    @if (ViewBag.TipoBusqueda == "unidad")
    {
        <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); margin-bottom: 30px;">
            <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 20px;">
                <h3 style="margin: 0; display: flex; align-items: center; gap: 10px; font-size: 1.5rem;">
                    <i class="bi bi-house-fill"></i> Resultados para unidad: <span style="font-family: monospace;">@ViewBag.Unidad</span>
                </h3>
            </div>

            <div style="padding: 25px;">
                <!-- Advertencia si está inactivo -->
                @if (ViewBag.ResidenteInactivo == true)
                {
                    <div style="background: #fee2e2; color: #991b1b; padding: 18px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #ef4444;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="bi bi-exclamation-triangle-fill" style="font-size: 1.3rem;"></i>
                            <div>
                                <div style="font-weight: 600; font-size: 1.1rem;">⚠️ RESIDENTE INACTIVO</div>
                                <div>No se permite registrar accesos hacia esta unidad</div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Información de la unidad -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <div style="background: #dbeafe; color: #1d4ed8; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-building"></i>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #6b7280;">Unidad</div>
                                <div style="font-weight: 600; font-size: 1.3rem; font-family: monospace;">@ViewBag.Unidad</div>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <div style="background: #e9d5ff; color: #7c3aed; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-geo-alt"></i>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #6b7280;">Dirección</div>
                                <div style="font-weight: 600;">@ViewBag.Direccion</div>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <div style="background: #d1fae5; color: #059669; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-toggle2-on"></i>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #6b7280;">Estado</div>
                                <div style="font-weight: 600; color: #059669;">@ViewBag.Estado</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vehículos registrados -->
                <div style="background: #f8fafc; border-radius: 8px; overflow: hidden; border: 1px solid #e5e7eb;">
                    <div style="background: #e5e7eb; padding: 15px 20px;">
                        <h4 style="margin: 0; display: flex; align-items: center; gap: 10px; color: #374151;">
                            <i class="bi bi-car-front"></i> Vehículos Registrados
                        </h4>
                    </div>

                    <div style="padding: 20px;">
                        @if (ViewBag.Vehiculos != null && ((List<string>)ViewBag.Vehiculos).Count > 0)
                        {
                            <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                                @foreach (var placa in (List<string>)ViewBag.Vehiculos)
                                {
                                    <div style="background: white; padding: 12px 18px; border-radius: 8px; border: 1px solid #d1d5db; display: flex; align-items: center; gap: 10px;">
                                        <i class="bi bi-car-front" style="color: #3b82f6;"></i>
                                        <span style="font-weight: 600; font-family: monospace; font-size: 1.1rem;">@placa</span>
                                    </div>
                                }
                            </div>
                            <div style="font-size: 14px; color: #6b7280; margin-top: 15px; display: flex; align-items: center; gap: 8px;">
                                <i class="bi bi-info-circle"></i>
                                <span>Total: @(((List<string>)ViewBag.Vehiculos).Count) vehículo(s) registrado(s)</span>
                            </div>
                        }
                        else
                        {
                            <div style="text-align: center; padding: 30px 20px; color: #9ca3af;">
                                <i class="bi bi-car-front" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                <p style="margin: 0; font-size: 1.1rem;">Esta unidad no tiene vehículos registrados</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Instrucciones cuando no hay búsqueda -->
    @if (ViewBag.TipoBusqueda == null && ViewBag.Error == null)
    {
        <div style="background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 10px; padding: 30px; text-align: center; color: #6b7280;">
            <i class="bi bi-search" style="font-size: 48px; margin-bottom: 20px; color: #9ca3af; opacity: 0.7;"></i>
            <h4 style="margin: 0 0 10px 0; color: #4b5563;">Realiza una búsqueda</h4>
            <p style="margin: 0;">Ingresa una placa de vehículo o número de unidad para consultar información</p>
        </div>
    }
</div>

<style>
    /* Efectos hover */
    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    a[href="/Guardia/Index"]:hover {
        background: rgba(255, 255, 255, 0.2);
        text-decoration: none;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        div[style*="max-width: 1200px"] {
            padding: 15px 10px;
        }

        .encabezado-superior {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start !important;
        }

        div[style*="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))"] {
            grid-template-columns: 1fr !important;
        }

        div[style*="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr))"] {
            grid-template-columns: 1fr !important;
        }

        .form-buttons {
            flex-direction: column;
            gap: 15px;
        }

        .modal-content {
            width: 95% !important;
            margin: 0 auto;
        }
    }

    @@media (max-width: 480px) {
        .modal-buttons {
            flex-direction: column;
            gap: 10px !important;
        }

            .modal-buttons button {
                width: 100%;
            }
    }
</style>